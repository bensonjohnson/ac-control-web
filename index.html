<!DOCTYPE html>
<!DOCTYPE html>
<html>
  <head>
    <title>HVAC Controller</title>
  </head>
  <body>
    <h1>HVAC Controller</h1>
    <h2>Temperature</h2>
    <p>Current Temperature: {{ current_temperature }}</p>
    <p>Set Temperature: <span id="set-temp-value">{{ set_temperature }}</span></p>
    <form id="set-temperature-form">
      <input type="number" step="0.1" name="set_temperature" value="{{ set_temperature }}">
      <button type="button" onclick="setTemperature()">Set</button>
    </form>

    <h2>System Status</h2>
    <p>Fan State: <span id="fan-state"></span></p>
    <p>Cooling State: <span id="cooling-state"></span></p>
    <p>Heating State: <span id="heating-state"></span></p>

    <script>
      function setTemperature() {
        var form = document.getElementById("set-temperature-form");
        var data = new FormData(form);

        fetch('/set_temperature', {
          method: 'POST',
          body: data
        })
        .then(response => response.json())
        .then(result => {
          console.log(result);
          if (result.message === 'Temperature set successfully') {
            // Update the set temperature value on the page
            document.getElementById("set-temp-value").innerText = result.set_temperature;
          }
        })
        .catch(error => {
          console.error('Error:', error);
        });
      }

      function updateHVACState() {
        fetch('/get_hvac_state')
          .then(response => response.json())
          .then(data => {
            document.getElementById("fan-state").innerText = data.fan_state;
            document.getElementById("cooling-state").innerText = data.cooling_state;
            document.getElementById("heating-state").innerText = data.heating_state;
          })
          .catch(error => {
            console.error('Error:', error);
          });
      }

      updateHVACState();
      setInterval(updateHVACState, 5000);
    </script>
  </body>
</html>

